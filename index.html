<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Augura Space - Enhanced Kp Index</title>
</head>
<style>
    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
    }

    body {
        background: linear-gradient(135deg, #0f0f23 0%, #1a1a2e 50%, #16213e 100%);
        color: #ffffff;
        font-family: 'Inter', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        min-height: 100vh;
        overflow-x: hidden;
    }

    /* Enhanced background with subtle animation */
    body::before {
        content: '';
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: 
            radial-gradient(circle at 20% 50%, rgba(120, 119, 198, 0.15) 0%, transparent 50%),
            radial-gradient(circle at 80% 20%, rgba(255, 119, 198, 0.08) 0%, transparent 50%),
            radial-gradient(circle at 40% 80%, rgba(120, 219, 226, 0.1) 0%, transparent 50%);
        animation: backgroundPulse 20s ease-in-out infinite;
        pointer-events: none;
        z-index: -1;
    }

    @keyframes backgroundPulse {
        0%, 100% { opacity: 1; }
        50% { opacity: 0.7; }
    }

    .header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 20px 40px;
        background: rgba(0, 0, 0, 0.4);
        backdrop-filter: blur(20px);
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        position: sticky;
        top: 0;
        z-index: 100;
    }

    .logo {
        font-size: 28px;
        font-weight: 300;
        letter-spacing: 3px;
        background: linear-gradient(135deg, #4ade80, #22d3ee);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        text-shadow: 0 0 30px rgba(74, 222, 128, 0.3);
    }

    .nav-links {
        display: flex;
        gap: 30px;
        font-size: 14px;
    }

    .nav-links a {
        color: #ffffff;
        text-decoration: none;
        opacity: 0.8;
        transition: all 0.3s ease;
        padding: 8px 16px;
        border-radius: 20px;
        position: relative;
    }

    .nav-links a:hover {
        opacity: 1;
        background: rgba(255, 255, 255, 0.1);
        transform: translateY(-2px);
    }

    .container {
        display: flex;
        min-height: calc(100vh - 80px);
    }

    .sidebar {
        width: 280px;
        background: rgba(0, 0, 0, 0.3);
        padding: 30px 0;
        backdrop-filter: blur(20px);
        border-right: 1px solid rgba(255, 255, 255, 0.1);
    }

    .sidebar-item {
        display: flex;
        align-items: center;
        padding: 18px 30px;
        font-size: 14px;
        cursor: pointer;
        transition: all 0.3s ease;
        border-left: 3px solid transparent;
        margin: 2px 0;
        position: relative;
    }

    .sidebar-item:hover {
        background: rgba(255, 255, 255, 0.08);
        transform: translateX(5px);
    }

    .sidebar-item.active {
        background: rgba(74, 222, 128, 0.15);
        border-left-color: #4ade80;
        color: #4ade80;
        box-shadow: 0 0 20px rgba(74, 222, 128, 0.2);
    }

    .sidebar-item::before {
        content: "‚¨°";
        margin-right: 15px;
        font-size: 16px;
        opacity: 0.7;
        transition: all 0.3s ease;
    }

    .sidebar-item:hover::before,
    .sidebar-item.active::before {
        opacity: 1;
        transform: rotate(90deg);
    }

    .main-content {
        flex: 1;
        padding: 40px;
        overflow-y: auto;
        max-height: calc(100vh - 80px);
    }

    .status-bar {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 20px;
        margin-bottom: 40px;
    }

    .status-card {
        background: rgba(0, 0, 0, 0.4);
        padding: 20px;
        border-radius: 12px;
        backdrop-filter: blur(15px);
        border: 1px solid rgba(255, 255, 255, 0.1);
        transition: all 0.3s ease;
        position: relative;
        overflow: hidden;
    }

    .status-card::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 2px;
        background: linear-gradient(90deg, #4ade80, #22d3ee, #a855f7);
        opacity: 0;
        transition: opacity 0.3s ease;
    }

    .status-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        border-color: rgba(255, 255, 255, 0.2);
    }

    .status-card:hover::before {
        opacity: 1;
    }

    .status-card h4 {
        font-size: 11px;
        opacity: 0.8;
        margin-bottom: 8px;
        text-transform: uppercase;
        letter-spacing: 1.5px;
        font-weight: 500;
    }

    .status-value {
        font-size: 18px;
        font-weight: 600;
        display: flex;
        align-items: center;
        gap: 8px;
    }

    .scale-badge {
        padding: 4px 10px;
        border-radius: 6px;
        font-size: 12px;
        font-weight: 600;
        text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
        transition: all 0.3s ease;
    }

    .scale-badge:hover {
        transform: scale(1.1);
    }

    .indices-section {
        background: rgba(0, 0, 0, 0.3);
        border-radius: 16px;
        padding: 40px;
        backdrop-filter: blur(20px);
        border: 1px solid rgba(255, 255, 255, 0.1);
        position: relative;
        overflow: hidden;
    }

    .indices-section::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 1px;
        background: linear-gradient(90deg, transparent, rgba(74, 222, 128, 0.5), transparent);
    }

    .section-header {
        display: flex;
        align-items: center;
        margin-bottom: 25px;
    }

    .section-header::before {
        content: "üåç";
        margin-right: 15px;
        font-size: 24px;
        filter: drop-shadow(0 0 10px rgba(74, 222, 128, 0.5));
    }

    .section-title {
        font-size: 24px;
        font-weight: 600;
        background: linear-gradient(135deg, #ffffff, #a0a0a0);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
    }

    .section-description {
        color: rgba(255, 255, 255, 0.9);
        line-height: 1.7;
        margin-bottom: 40px;
        font-size: 14px;
        text-align: justify;
    }

    .section-description a {
        color: #4ade80;
        text-decoration: none;
        border-bottom: 1px solid rgba(74, 222, 128, 0.3);
        transition: all 0.3s ease;
    }

    .section-description a:hover {
        border-bottom-color: #4ade80;
        text-shadow: 0 0 10px rgba(74, 222, 128, 0.5);
    }

    .charts-container {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 30px;
        margin-top: 40px;
    }

    @media (max-width: 1200px) {
        .charts-container {
            grid-template-columns: 1fr;
            gap: 30px;
        }
    }

    .chart-container {
        background: rgba(0, 0, 0, 0.4);
        border-radius: 12px;
        padding: 25px;
        backdrop-filter: blur(15px);
        border: 1px solid rgba(255, 255, 255, 0.1);
        transition: all 0.3s ease;
    }

    .chart-container:hover {
        border-color: rgba(255, 255, 255, 0.2);
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
    }

    .chart-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 25px;
        flex-wrap: wrap;
        gap: 15px;
    }

    .chart-title {
        font-size: 18px;
        font-weight: 600;
        color: #ffffff;
    }

    .time-selector {
        display: flex;
        gap: 8px;
        align-items: center;
        flex-wrap: wrap;
    }

    .time-selector span {
        font-size: 12px;
        color: rgba(255, 255, 255, 0.7);
        margin-right: 10px;
    }

    .time-btn {
        padding: 8px 16px;
        background: rgba(255, 255, 255, 0.1);
        border: 1px solid rgba(255, 255, 255, 0.2);
        border-radius: 8px;
        color: #ffffff;
        font-size: 12px;
        cursor: pointer;
        transition: all 0.3s ease;
        font-weight: 500;
    }

    .time-btn:hover {
        background: rgba(255, 255, 255, 0.2);
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
    }

    .time-btn.active {
        background: linear-gradient(135deg, #4ade80, #22d3ee);
        border-color: transparent;
        color: #000000;
        font-weight: 600;
        box-shadow: 0 4px 15px rgba(74, 222, 128, 0.4);
    }

    /* Enhanced Kp Chart Styles */
    .chart-area {
        height: 400px;
        background: rgba(0, 0, 0, 0.6);
        border-radius: 12px;
        position: relative;
        overflow: hidden;
        border: 1px solid rgba(255, 255, 255, 0.1);
        margin-bottom: 20px;
    }

    .chart-grid {
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        pointer-events: none;
    }

    .grid-line {
        position: absolute;
        left: 60px;
        right: 80px;
        height: 1px;
        background: rgba(255, 255, 255, 0.08);
    }

    .y-axis-labels {
        position: absolute;
        left: 10px;
        top: 20px;
        bottom: 60px;
        display: flex;
        flex-direction: column;
        justify-content: space-between;
        font-size: 12px;
        color: rgba(255, 255, 255, 0.7);
        font-weight: 500;
        width: 40px;
    }

    .y-axis-label {
        text-align: right;
        line-height: 1;
    }

    .kp-bars-container {
        position: absolute;
        left: 60px;
        right: 80px;
        top: 20px;
        bottom: 60px;
        display: flex;
        align-items: flex-end;
        gap: 4px;
        padding: 0 5px;
    }

    .kp-bar {
        flex: 1;
        background: #7dd3fc;
        border-radius: 3px 3px 0 0;
        min-height: 3px;
        transition: all 0.3s ease;
        position: relative;
        cursor: pointer;
        border: 1px solid rgba(255, 255, 255, 0.1);
    }

    .kp-bar:hover {
        opacity: 0.8;
        transform: scaleX(1.05);
        z-index: 10;
        box-shadow: 0 0 15px rgba(255, 255, 255, 0.3);
    }

    .kp-bar::after {
        content: attr(data-value);
        position: absolute;
        bottom: 100%;
        left: 50%;
        transform: translateX(-50%);
        font-size: 11px;
        color: rgba(255, 255, 255, 0.9);
        opacity: 0;
        transition: all 0.3s ease;
        background: rgba(0, 0, 0, 0.9);
        padding: 6px 10px;
        border-radius: 6px;
        font-weight: 600;
        white-space: nowrap;
        margin-bottom: 8px;
        border: 1px solid rgba(255, 255, 255, 0.2);
    }

    .kp-bar:hover::after {
        opacity: 1;
    }

    .x-axis-labels {
        position: absolute;
        left: 60px;
        right: 80px;
        bottom: 15px;
        height: 40px;
        display: flex;
        align-items: center;
        font-size: 11px;
        color: rgba(255, 255, 255, 0.7);
        padding: 0 5px;
        gap: 4px;
    }

    .x-axis-label {
        flex: 1;
        text-align: center;
        font-weight: 500;
        line-height: 1.2;
    }

    .storm-levels {
        position: absolute;
        right: 10px;
        top: 20px;
        font-size: 10px;
        color: rgba(255, 255, 255, 0.8);
        background: rgba(0, 0, 0, 0.5);
        padding: 10px;
        border-radius: 8px;
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.1);
    }

    .storm-level {
        display: flex;
        align-items: center;
        margin-bottom: 6px;
        font-weight: 500;
    }

    .storm-level:last-child {
        margin-bottom: 0;
    }

    .storm-color {
        width: 14px;
        height: 14px;
        border-radius: 3px;
        margin-right: 8px;
        border: 1px solid rgba(255, 255, 255, 0.2);
    }

    .storm-levels-title {
        font-weight: 600;
        margin-bottom: 8px;
        font-size: 11px;
        color: rgba(255, 255, 255, 0.9);
    }

    .chart-description {
        font-size: 13px;
        color: rgba(255, 255, 255, 0.8);
        line-height: 1.6;
        text-align: justify;
        margin-top: 15px;
    }

    .data-indicator {
        position: absolute;
        top: 15px;
        left: 70px;
        font-size: 11px;
        color: rgba(255, 255, 255, 0.9);
        padding: 6px 12px;
        border-radius: 6px;
        font-weight: 600;
        backdrop-filter: blur(10px);
        z-index: 10;
    }

    .live-data {
        background: rgba(34, 197, 94, 0.3);
        border: 1px solid rgba(34, 197, 94, 0.5);
        box-shadow: 0 0 15px rgba(34, 197, 94, 0.2);
    }

    .demo-data {
        background: rgba(245, 158, 11, 0.3);
        border: 1px solid rgba(245, 158, 11, 0.5);
        box-shadow: 0 0 15px rgba(245, 158, 11, 0.2);
    }

    .loading {
        display: flex;
        align-items: center;
        justify-content: center;
        height: 100%;
        color: rgba(255, 255, 255, 0.6);
        font-size: 16px;
        flex-direction: column;
        gap: 10px;
    }

    .placeholder-chart {
        display: flex;
        align-items: center;
        justify-content: center;
        height: 400px;
        background: rgba(0, 0, 0, 0.5);
        border-radius: 8px;
        color: rgba(255, 255, 255, 0.5);
        font-size: 16px;
        border: 2px dashed rgba(255, 255, 255, 0.2);
        flex-direction: column;
        gap: 10px;
    }

    .placeholder-chart::before {
        content: "üìä";
        font-size: 32px;
        opacity: 0.5;
    }

    @keyframes pulse {
        0%, 100% { opacity: 1; }
        50% { opacity: 0.5; }
    }

    .loading {
        animation: pulse 2s ease-in-out infinite;
    }

    /* Responsive design */
    @media (max-width: 768px) {
        .container {
            flex-direction: column;
        }
        
        .sidebar {
            width: 100%;
            padding: 20px 0;
            order: 2;
        }
        
        .main-content {
            padding: 20px;
            order: 1;
        }
        
        .header {
            padding: 15px 20px;
        }
        
        .logo {
            font-size: 20px;
        }
        
        .status-bar {
            grid-template-columns: 1fr;
        }
        
        .indices-section {
            padding: 20px;
        }

        .storm-levels {
            position: relative;
            right: auto;
            top: auto;
            margin-top: 15px;
            width: 100%;
        }

        .kp-bars-container {
            right: 20px;
        }

        .grid-line {
            right: 20px;
        }

        .x-axis-labels {
            right: 20px;
        }
    }

    /* Enhanced scrollbar */
    ::-webkit-scrollbar {
        width: 8px;
    }

    ::-webkit-scrollbar-track {
        background: rgba(0, 0, 0, 0.3);
        border-radius: 4px;
    }

    ::-webkit-scrollbar-thumb {
        background: linear-gradient(135deg, #4ade80, #22d3ee);
        border-radius: 4px;
    }

    ::-webkit-scrollbar-thumb:hover {
        background: linear-gradient(135deg, #22d3ee, #4ade80);
    }
</style>
<body>
    <div class="header">
        <div class="logo">Augura Space</div>
        <div class="nav-links">
            <a href="#data">Data</a>
            <a href="#contact">Contact</a>
        </div>
    </div>

    <div class="container">
        <div class="sidebar">
            <div class="sidebar-item">Summary</div>
            <div class="sidebar-item">Solar Wind</div>
            <div class="sidebar-item">Particles Flux</div>
            <div class="sidebar-item">NOAA Scales</div>
            <div class="sidebar-item active">Geomagnetic Indices</div>
            <div class="sidebar-item">Solar Images</div>
            <div class="sidebar-item">Ionosphere</div>
            <div class="sidebar-item">Cosmic Rays</div>
        </div>

        <div class="main-content">
            <div class="status-bar">
                <div class="status-card">
                    <h4>Space Weather Essentials</h4>
                    <div class="status-value">
                        <span class="scale-badge" style="background: #4ade80;">R</span>
                        <span class="scale-badge" style="background: #fbbf24;">S</span>
                        <span class="scale-badge" style="background: #4ade80;">G</span>
                        <span style="margin-left: 10px; font-size: 12px; opacity: 0.7;">‚ìò</span>
                    </div>
                </div>

                <div class="status-card">
                    <h4>24h Observed Maximum</h4>
                    <div class="status-value">
                        <span class="scale-badge" style="background: #4ade80;">R</span>
                        <span class="scale-badge" style="background: #fbbf24;">S</span>
                        <span class="scale-badge" style="background: #4ade80;">G</span>
                        <span style="margin-left: 10px; font-size: 12px; opacity: 0.7;">‚ìò</span>
                    </div>
                </div>

                <div class="status-card">
                    <h4>Latest Observed</h4>
                    <div class="status-value">
                        <span class="scale-badge" style="background: #4ade80;">R</span>
                        <span class="scale-badge" style="background: #fbbf24;">S</span>
                        <span class="scale-badge" style="background: #4ade80;">G</span>
                        <span style="margin-left: 10px; font-size: 12px; opacity: 0.7;">‚ìò</span>
                    </div>
                </div>

                <div class="status-card">
                    <h4>Kp Index</h4>
                    <div class="status-value" id="current-kp">
                        1+ <span style="margin-left: 10px; font-size: 12px; opacity: 0.7;">‚ìò</span>
                    </div>
                </div>

                <div class="status-card">
                    <h4>Solar Wind Speed</h4>
                    <div class="status-value">346.8 km/sec</div>
                    <div style="font-size: 10px; opacity: 0.6; margin-top: 2px;">Solar Wind Magnetic Field: 3+ ‚Ä¢ 7.67 nT</div>
                </div>
            </div>

            <div class="indices-section">
                <div class="section-header">
                    <div class="section-title">Geomagnetic Indices</div>
                </div>

                <div class="section-description">
                    This section presents key geomagnetic indices used to monitor and quantify disturbances in Earth's magnetosphere caused by solar activity. 
                    The Kp index provides a global measure of geomagnetic activity over 3-hour intervals, while the Dst index reflects the intensity of the ring current, a key indicator of geomagnetic storm strength. 
                    The Dst index is provided by the World Data Center for Geomagnetism (<a href="#" style="color: #4ade80;">WDC Kyoto</a>), The Kp index is provided by the NOAA Space Weather Prediction Center (<a href="#" style="color: #4ade80;">NOAA SWPC</a>).
                </div>

                <div class="charts-container">
                    <div class="chart-container">
                        <div class="chart-header">
                            <div class="chart-title">DST Index (nT)</div>
                            <div class="time-selector">
                                <span>Zoom:</span>
                                <button class="time-btn" data-period="6h">6h</button>
                                <button class="time-btn" data-period="12h">12h</button>
                                <button class="time-btn active" data-period="24h">24h</button>
                                <button class="time-btn" data-period="3d">3d</button>
                                <button class="time-btn" data-period="7d">7d</button>
                                <button class="time-btn" data-period="all">All</button>
                            </div>
                        </div>
                        <div class="placeholder-chart">
                            DST Index - Coming Soon
                        </div>
                        <div class="chart-description">
                            The Dst (Disturbance storm time) index measures the intensity of Earth's ring current, which dominates the main phase of 
                            geomagnetic storms. Negative values indicate storm conditions, with thresholds such as -50 nT for moderate storms and -100 
                            nT for intense storms.
                        </div>
                    </div>

                    <div class="chart-container">
                        <div class="chart-header">
                            <div class="chart-title">Kp Index</div>
                            <div class="time-selector">
                                <span>Zoom:</span>
                                <button class="time-btn" data-period="6h">6h</button>
                                <button class="time-btn" data-period="12h">12h</button>
                                <button class="time-btn active" data-period="24h">24h</button>
                                <button class="time-btn" data-period="3d">3d</button>
                                <button class="time-btn" data-period="7d">7d</button>
                                <button class="time-btn" data-period="all">All</button>
                            </div>
                        </div>
                        <div class="chart-area" id="chart-area">
                            <div class="y-axis-labels">
                                <div class="y-axis-label">9</div>
                                <div class="y-axis-label">8</div>
                                <div class="y-axis-label">7</div>
                                <div class="y-axis-label">6</div>
                                <div class="y-axis-label">5</div>
                                <div class="y-axis-label">4</div>
                                <div class="y-axis-label">3</div>
                                <div class="y-axis-label">2</div>
                                <div class="y-axis-label">1</div>
                                <div class="y-axis-label">0</div>
                            </div>
                            
                            <div class="chart-grid">
                                <div class="grid-line" style="top: 5.5%"></div>
                                <div class="grid-line" style="top: 16.5%"></div>
                                <div class="grid-line" style="top: 27.5%"></div>
                                <div class="grid-line" style="top: 38.5%"></div>
                                <div class="grid-line" style="top: 49.5%"></div>
                                <div class="grid-line" style="top: 60.5%"></div>
                                <div class="grid-line" style="top: 71.5%"></div>
                                <div class="grid-line" style="top: 82.5%"></div>
                                <div class="grid-line" style="top: 93.5%"></div>
                            </div>

                            <div class="storm-levels">
                                <div class="storm-levels-title">Storm Levels</div>
                                <div class="storm-level">
                                    <div class="storm-color" style="background: #dc2626;"></div>
                                    <span>G5 (Kp 9)</span>
                                </div>
                                <div class="storm-level">
                                    <div class="storm-color" style="background: #ea580c;"></div>
                                    <span>G4 (Kp 8)</span>
                                </div>
                                <div class="storm-level">
                                    <div class="storm-color" style="background: #f59e0b;"></div>
                                    <span>G3 (Kp 7)</span>
                                </div>
                                <div class="storm-level">
                                    <div class="storm-color" style="background: #eab308;"></div>
                                    <span>G2 (Kp 6)</span>
                                </div>
                                <div class="storm-level">
                                    <div class="storm-color" style="background: #22c55e;"></div>
                                    <span>G1 (Kp 5)</span>
                                </div>
                                <div class="storm-level">
                                    <div class="storm-color" style="background: #10b981;"></div>
                                    <span>G0 (Kp 0-4)</span>
                                </div>
                            </div>
                            
                            <div class="kp-bars-container" id="kp-chart">
                                <div class="loading">Loading Kp data...</div>
                            </div>
                            
                            <div class="x-axis-labels" id="x-axis-labels"></div>
                        </div>

                        <div class="chart-description">
                            The Kp index is a global geomagnetic activity index derived from 13 subauroral observatories, providing a standardized 
                            measure of geomagnetic disturbances over 3-hour intervals. It is widely used for operational space weather monitoring and to 
                            assess the potential impacts on satellites, GNSS, and power grids. Values above Kp=5 indicate geomagnetic storm 
                            conditions.
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        class EnhancedKpChart {
            constructor() {
                this.data = [];
                this.currentPeriod = '24h';
                this.colors = {
                    0: '#10b981', // G0 - Quiet
                    1: '#10b981',
                    2: '#10b981',
                    3: '#10b981',
                    4: '#10b981',
                    5: '#22c55e', // G1 - Minor storm
                    6: '#eab308', // G2 - Moderate storm
                    7: '#f59e0b', // G3 - Strong storm
                    8: '#ea580c', // G4 - Severe storm
                    9: '#dc2626'  // G5 - Extreme storm
                };
                this.init();
            }

            async init() {
                this.setupEventListeners();
                await this.fetchData();
                
                // Auto-refresh every 15 minutes
                setInterval(() => {
                    this.fetchData();
                }, 15 * 60 * 1000);
            }

            async fetchData() {
                console.log('Fetching Kp data...');
                try {
                    const apiUrl = 'https://services.swpc.noaa.gov/json/planetary_k_index_1m.json';
                    const response = await fetch(apiUrl);

                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }

                    const data = await response.json();
                    console.log('Live data fetched successfully');
                    this.processLiveData(data);
                    this.showDataIndicator('live');
                } catch (error) {
                    console.error('Live data fetch failed, using demo data:', error);
                    this.generateMockData();
                    this.showDataIndicator('demo');
                }
            }

            processLiveData(data) {
                if (!data || data.length === 0) {
                    this.generateMockData();
                    return;
                }

                const now = new Date();
                const hoursBack = this.getPeriodHours();
                const startTime = new Date(now.getTime() - hoursBack * 60 * 60 * 1000);

                // Create time slots based on period
                const timeSlots = this.generateTimeSlots(startTime, now);
                
                // Group data by time slots
                const grouped = {};
                timeSlots.forEach(slot => {
                    grouped[slot.key] = {
                        time: slot.time,
                        values: []
                    };
                });

                data.forEach(entry => {
                    const date = new Date(entry.time_tag);
                    if (date < startTime) return;

                    // Find the appropriate time slot
                    const slot = this.findTimeSlot(date, timeSlots);
                    if (slot && grouped[slot.key]) {
                        grouped[slot.key].values.push(parseFloat(entry.kp_index) || 0);
                    }
                });

                // Convert to chart data
                this.data = timeSlots.map(slot => {
                    const groupData = grouped[slot.key];
                    let kp = 0;
                    
                    if (groupData.values.length > 0) {
                        kp = groupData.values.reduce((a, b) => a + b, 0) / groupData.values.length;
                        kp = Math.round(kp * 3) / 3; // Round to nearest third
                    }
                    
                    return {
                        time: groupData.time,
                        kp: Math.min(9, Math.max(0, kp)),
                        label: this.formatTimeLabel(groupData.time)
                    };
                });

                if (this.data.length === 0) {
                    this.generateMockData();
                    return;
                }

                this.renderChart();
                this.updateCurrentKp();
            }

            generateTimeSlots(startTime, endTime) {
                const slots = [];
                const intervalHours = this.getIntervalHours();
                const current = new Date(startTime);
                
                // Align to proper interval boundary
                if (intervalHours === 3) {
                    current.setHours(Math.floor(current.getHours() / 3) * 3, 0, 0, 0);
                } else if (intervalHours === 1) {
                    current.setMinutes(0, 0, 0);
                } else if (intervalHours === 0.5) {
                    current.setMinutes(Math.floor(current.getMinutes() / 30) * 30, 0, 0);
                }

                while (current <= endTime) {
                    const key = current.toISOString();
                    slots.push({
                        key: key,
                        time: new Date(current)
                    });
                    current.setTime(current.getTime() + intervalHours * 60 * 60 * 1000);
                }

                return slots;
            }

            findTimeSlot(date, timeSlots) {
                const intervalMs = this.getIntervalHours() * 60 * 60 * 1000;
                
                for (let slot of timeSlots) {
                    if (date >= slot.time && date < new Date(slot.time.getTime() + intervalMs)) {
                        return slot;
                    }
                }
                
                // Find closest slot if exact match not found
                let closest = timeSlots[0];
                let minDiff = Math.abs(date - closest.time);
                
                for (let slot of timeSlots) {
                    const diff = Math.abs(date - slot.time);
                    if (diff < minDiff) {
                        minDiff = diff;
                        closest = slot;
                    }
                }
                
                return closest;
            }

            getIntervalHours() {
                switch (this.currentPeriod) {
                    case '6h': return 0.5; // 30 minute intervals
                    case '12h': return 1;   // 1 hour intervals
                    case '24h': return 3;   // 3 hour intervals
                    case '3d': return 3;    // 3 hour intervals
                    case '7d': return 6;    // 6 hour intervals
                    case 'all': return 12;  // 12 hour intervals
                    default: return 3;
                }
            }

            generateMockData() {
                console.log('Generating demo data...');
                const now = new Date();
                const hoursBack = this.getPeriodHours();
                const intervalHours = this.getIntervalHours();
                const intervals = Math.floor(hoursBack / intervalHours);
                
                this.data = [];
                for (let i = intervals - 1; i >= 0; i--) {
                    const time = new Date(now.getTime() - i * intervalHours * 60 * 60 * 1000);
                    
                    // Generate realistic Kp values with some variability
                    let kp;
                    const rand = Math.random();
                    if (rand < 0.02) {
                        kp = Math.random() * 1 + 8; // 2% chance of extreme storm
                    } else if (rand < 0.08) {
                        kp = Math.random() * 2 + 6; // 6% chance of strong storm
                    } else if (rand < 0.20) {
                        kp = Math.random() * 2 + 4; // 12% chance of moderate activity
                    } else {
                        kp = Math.random() * 4; // 80% chance of quiet to minor activity
                    }
                    
                    this.data.push({
                        time: time,
                        kp: Math.min(9, Math.max(0, Math.round(kp * 3) / 3)),
                        label: this.formatTimeLabel(time)
                    });
                }

                this.renderChart();
                this.updateCurrentKp();
            }

            getPeriodHours() {
                const periods = {
                    '6h': 6,
                    '12h': 12,
                    '24h': 24,
                    '3d': 72,
                    '7d': 168,
                    'all': 336 // 2 weeks
                };
                return periods[this.currentPeriod] || 24;
            }

            formatTimeLabel(date) {
                if (this.currentPeriod === '6h') {
                    // Show minutes for 6h view
                    return String(date.getHours()).padStart(2, '0') + ':' + 
                           String(date.getMinutes()).padStart(2, '0');
                } else if (this.currentPeriod === '12h' || this.currentPeriod === '24h') {
                    return String(date.getHours()).padStart(2, '0') + ':00';
                } else {
                    const day = String(date.getDate()).padStart(2, '0');
                    const month = date.toLocaleDateString('en', { month: 'short' });
                    const hour = String(date.getHours()).padStart(2, '0');
                    return `${day} ${month}\n${hour}:00`;
                }
            }

            renderChart() {
                const container = document.getElementById('kp-chart');
                const xLabelsContainer = document.getElementById('x-axis-labels');
                
                if (!this.data || this.data.length === 0) {
                    container.innerHTML = '<div class="loading">No data available</div>';
                    xLabelsContainer.innerHTML = '';
                    return;
                }

                // Clear containers
                container.innerHTML = '';
                xLabelsContainer.innerHTML = '';

                // Limit number of bars for better visibility
                const maxBars = this.getMaxBarsForPeriod();
                const displayData = this.data.slice(-maxBars);

                // Create bars
                displayData.forEach((point, index) => {
                    const bar = document.createElement('div');
                    bar.className = 'kp-bar';
                    
                    // Calculate height (0-9 scale)
                    const height = Math.max(1, (point.kp / 9) * 100);
                    bar.style.height = `${height}%`;
                    
                    // Set color based on Kp value
                    const kpLevel = Math.min(9, Math.max(0, Math.floor(point.kp)));
                    bar.style.backgroundColor = this.colors[kpLevel] || '#7dd3fc';
                    
                    // Add tooltip
                    const formattedTime = point.time.toLocaleString('en-US', {
                        month: 'short',
                        day: 'numeric',
                        hour: '2-digit',
                        minute: '2-digit'
                    });
                    bar.setAttribute('data-value', `${formattedTime} | Kp: ${point.kp.toFixed(1)} | ${this.getStormLevel(point.kp)}`);
                    
                    container.appendChild(bar);
                });

                // Create x-axis labels with better spacing
                const labelStep = Math.max(1, Math.ceil(displayData.length / 8));
                displayData.forEach((point, index) => {
                    const label = document.createElement('div');
                    label.className = 'x-axis-label';
                    
                    if (index % labelStep === 0 || index === displayData.length - 1) {
                        label.textContent = point.label;
                    }
                    
                    xLabelsContainer.appendChild(label);
                });
            }

            getStormLevel(kp) {
                if (kp >= 9) return 'G5 - Extreme';
                if (kp >= 8) return 'G4 - Severe';
                if (kp >= 7) return 'G3 - Strong';
                if (kp >= 6) return 'G2 - Moderate';
                if (kp >= 5) return 'G1 - Minor';
                return 'G0 - Quiet';
            }

            getMaxBarsForPeriod() {
                const maxBars = {
                    '6h': 12,   // 30-min intervals for 6h
                    '12h': 12,  // 1-hour intervals for 12h
                    '24h': 8,   // 3-hour intervals for 24h
                    '3d': 24,   // 3-hour intervals for 3d
                    '7d': 28,   // 6-hour intervals for 7d
                    'all': 28   // 12-hour intervals for 2 weeks
                };
                return maxBars[this.currentPeriod] || 8;
            }

            updateCurrentKp() {
                if (this.data && this.data.length > 0) {
                    const latestPoint = this.data[this.data.length - 1];
                    if (latestPoint && typeof latestPoint.kp === 'number') {
                        const latestKp = latestPoint.kp;
                        const kpDisplay = document.getElementById('current-kp');
                        
                        // Format Kp value with +/o/- notation
                        let kpFormatted = Math.floor(latestKp).toString();
                        const decimal = latestKp - Math.floor(latestKp);
                        if (decimal >= 0.67) kpFormatted += '+';
                        else if (decimal >= 0.33) kpFormatted += 'o';
                        else if (decimal > 0) kpFormatted += '-';
                        
                        kpDisplay.innerHTML = `${kpFormatted} <span style="margin-left: 10px; font-size: 12px; opacity: 0.7;">‚ìò</span>`;
                    }
                }
            }

            showDataIndicator(type) {
                const chartArea = document.getElementById('chart-area');
                const existing = chartArea.querySelector('.data-indicator');
                if (existing) existing.remove();

                const indicator = document.createElement('div');
                indicator.className = `data-indicator ${type === 'live' ? 'live-data' : 'demo-data'}`;
                indicator.textContent = type === 'live' ? 'üõ∞Ô∏è Live Data' : 'üì° Demo Data';
                
                chartArea.appendChild(indicator);
            }

            setupEventListeners() {
                // Kp chart time selector buttons
                const kpTimeButtons = document.querySelectorAll('.chart-container:last-child .time-btn');
                kpTimeButtons.forEach(btn => {
                    btn.addEventListener('click', () => {
                        kpTimeButtons.forEach(b => b.classList.remove('active'));
                        btn.classList.add('active');
                        
                        this.currentPeriod = btn.dataset.period;
                        
                        // Re-process data for new period
                        if (document.querySelector('.data-indicator.demo-data')) {
                            this.generateMockData();
                        } else {
                            this.fetchData();
                        }
                    });
                });

                // DST chart time selector buttons (placeholder)
                const dstTimeButtons = document.querySelectorAll('.chart-container:first-child .time-btn');
                dstTimeButtons.forEach(btn => {
                    btn.addEventListener('click', () => {
                        dstTimeButtons.forEach(b => b.classList.remove('active'));
                        btn.classList.add('active');
                    });
                });

                // Sidebar navigation
                const sidebarItems = document.querySelectorAll('.sidebar-item');
                sidebarItems.forEach(item => {
                    item.addEventListener('click', () => {
                        sidebarItems.forEach(i => i.classList.remove('active'));
                        item.classList.add('active');
                    });
                });

                // Status card hover effects
                const statusCards = document.querySelectorAll('.status-card');
                statusCards.forEach(card => {
                    card.addEventListener('mouseenter', () => {
                        card.style.transform = 'translateY(-8px) scale(1.02)';
                    });
                    
                    card.addEventListener('mouseleave', () => {
                        card.style.transform = 'translateY(0) scale(1)';
                    });
                });

                // Keyboard shortcuts
                document.addEventListener('keydown', (e) => {
                    if (e.key === 'r' && e.ctrlKey) {
                        e.preventDefault();
                        this.fetchData();
                    }
                });
            }
        }

        // Initialize the application
        document.addEventListener('DOMContentLoaded', () => {
            console.log('Initializing Enhanced Augura Space Kp Chart...');
            new EnhancedKpChart();
            console.log('‚ú® Application initialized successfully!');
        });
    </script>
</body>
</html>